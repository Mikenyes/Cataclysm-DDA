[
  {
    "type": "effect_on_condition",
    "id": "changing_initiate_check",
    "//": "Give player a tier zero trait, maybe",
    "recurrence_min": "30 s",
    "recurrence_max": "45 s",
    "condition": {
      "and": [
        { "compare_int": [ { "u_val": "vitamin", "name": "mutagen" }, ">=", { "const": 200 } ] },
        { "not": { "u_has_flag": "CHANGING" } }
      ]
    },
    "deactivate_condition": { "u_has_flag": "CHANGING" },
    "effect": [
      { "u_lose_var": "mutation_progress", "type": "counter", "context": "mutation" },
      { "u_add_var": "mutation_progress_required", "type": "counter", "context": "mutation", "value": "10" },
      { "arithmetic": [ { "u_val": "vitamin", "name": "mutagen" }, "-=", { "const": 30 } ] },
      { "arithmetic": [ { "u_val": "vitamin", "name": "mutagen" }, "-=", { "rand": 20 } ] },
      {
        "set_weighted_list_eocs": [
          [ "changing_failed", { "const": 3000 } ],
          [
            {
              "id": "changing_successful",
              "effect": [
                { "u_add_trait": "CHANGING" },
                {
                  "set_weighted_list_eocs": [
                    [
                      {
                        "id": "changing_successful_ecto",
                        "effect": [
                          { "u_message": "You feel a strange chill come over you, filling every part of your body." },
                          { "u_add_trait": "ROOT_ECTO" },
                          { "u_add_var": "mutation_goal", "type": "category", "context": "mutation", "value": "LEAF_ECTO" }
                        ]
                      },
                      { "const": 1 }
                    ]
                  ]
                }
              ]
            },
            { "u_val": "vitamin", "name": "mutagen" }
          ]
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "changing_failed",
    "effect": [ { "u_message": "You feel a shift in your body, but it quickly reverts." } ]
  },
  {
    "type": "effect_on_condition",
    "id": "changing_reqs_not_met",
    "condition": {
      "and": [ { "u_has_var": "mutation_progress", "type": "counter", "context": "mutation" }, { "not": { "one_in_chance": 6 } } ]
    },
    "effect": [
      {
        "u_message": "You feel the possibility to change, but you just can't quite reach it.  You need more mutagen.  You need it.",
        "type": "bad"
      },
      {
        "arithmetic": [ { "u_val": "var", "var_name": "mutation_progress", "type": "counter", "context": "mutation" }, "-=", { "const": 9 } ]
      }
    ],
    "false_effect": [ {
        "u_message": "You can palpably feel the churning sensation within fade, your mutation cut short by a lack of nutrients.",
        "type": "bad"
      },
      { "u_lose_trait": "CHANGING" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "changing_increment",
    "//": "Variable incrementer",
    "recurrence_min": "10 s",
    "recurrence_max": "30 s",
    "condition": {
      "and": [ { "u_has_flag": "CHANGING" }, { "compare_int": [ { "u_val": "vitamin", "name": "mutagen" }, ">=", { "const": 100 } ] } ]
    },
    "deactivate_condition": { "not": { "u_has_flag": "CHANGING" } },
    "effect": [
      { "u_adjust_var": "mutation_progress", "type": "counter", "context": "mutation", "adjustment": 1 },
      { "arithmetic": [ { "u_val": "vitamin", "name": "mutagen" }, "-=", { "const": 1 } ] },
      { "set_queue_effect_on_condition": [ "changing_mutate" ] }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "changing_mutate",
    "//": "Is it time for mutation?",
    "condition": {
      "compare_int": [
        { "u_val": "var", "var_name": "mutation_progress", "type": "counter", "context": "mutation" },
        "==",
        { "u_val": "var", "var_name": "mutation_progress_required", "type": "counter", "context": "mutation" }
      ]
    },
    "effect": [
      {
        "set_queue_effect_on_condition": [
          {
            "id": "changing_mutate2",
            "//": "Mutate!",
            "condition": { "compare_int": [ { "u_val": "vitamin", "name": "mutagen" }, ">=", { "const": 300 } ] },
            "effect": [
              { "u_mutate_category": { "u_val": "mutation_goal", "type": "category", "context": "mutation", "default_str": "NULL" } },
              { "u_message": "You mutated!", "type": "good" },
              {
                "arithmetic": [
                  { "u_val": "var", "var_name": "mutation_progress_required", "type": "counter", "context": "mutation" },
                  "+=",
                  { "const": 10 }
                ]
              }
            ],
            "false_effect": [ { "set_queue_effect_on_condition": [ "changing_reqs_not_met" ] } ]
          }
        ]
      }
    ]
  }
]
